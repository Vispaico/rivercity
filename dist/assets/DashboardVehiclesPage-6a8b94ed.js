import{k as F,r as d,j as e,q as n,I as h,B as g,L as B}from"./index-80ac856c.js";import{P as L}from"./PageHeader-0a5c0ed7.js";import{C as v,a as _,b as f,e as N,c as w}from"./card-b8ee0251.js";import{L as o}from"./label-d30f68fa.js";const H=()=>{const{toast:l}=F(),[C,y]=d.useState(!0),[p,m]=d.useState(null),[j,k]=d.useState([]),[r,u]=d.useState({category:"motorbike",name:"",price_per_day:"",inventory_count:"0",active:!0}),I=d.useMemo(()=>j.reduce((t,i)=>{const a=i.category||"other";return t[a]=t[a]||[],t[a].push(i),t},{}),[j]),x=async()=>{if(!n){y(!1);return}y(!0);const{data:t,error:i}=await n.from("vehicles").select("id, category, name, price_per_day, inventory_count, active, sort_order").order("sort_order",{ascending:!0}).order("name",{ascending:!0});i?(l({title:"Failed to load vehicles",description:i.message,variant:"destructive"}),k([])):k(t||[]),y(!1)};d.useEffect(()=>{x()},[]);const b=async(t,i)=>{if(!n)return;m(t);const{error:a}=await n.from("vehicles").update(i).eq("id",t);a?l({title:"Save failed",description:a.message,variant:"destructive"}):(l({title:"Saved",description:"Vehicle updated.",className:"bg-blue-500 text-white"}),await x()),m(null)},A=async()=>{if(!n)return;const t=r.name.trim();if(!t){l({title:"Name required",description:"Enter a vehicle name.",variant:"destructive"});return}const i=Math.max(0,parseInt(r.inventory_count,10)||0),a=r.price_per_day===""?null:Number(r.price_per_day);m("new");const c={category:r.category,name:t,inventory_count:i,price_per_day:Number.isFinite(a)?a:null,active:!!r.active};let{error:s}=await n.from("vehicles").insert([{...c,listing_status:"approved"}]);if(s&&/column .*listing_status.* does not exist/i.test(s.message)&&({error:s}=await n.from("vehicles").insert([c])),s){l({title:"Create failed",description:s.message,variant:"destructive"}),m(null);return}l({title:"Created",description:"Vehicle added.",className:"bg-blue-500 text-white"}),u({category:"motorbike",name:"",price_per_day:"",inventory_count:"0",active:!0}),await x(),m(null)};return e.jsxs("div",{className:"bg-gray-50",children:[e.jsx(L,{title:"Vehicle Inventory",subtitle:"Set availability per vehicle model (inventory count).",breadcrumbs:[{name:"Home",link:"/"},{name:"Dashboard",link:"/dashboard"},{name:"Vehicles"}]}),e.jsxs("main",{className:"container mx-auto px-4 py-12 space-y-6",children:[!n&&e.jsx(v,{className:"shadow-lg",children:e.jsxs(_,{children:[e.jsx(f,{children:"Supabase not configured"}),e.jsx(N,{children:"Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY to enable inventory management."})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(_,{children:[e.jsx(f,{children:"Add a vehicle"}),e.jsx(N,{children:"This controls what shows on the booking page. You can also manage vehicles in Supabase Table Editor."})]}),e.jsxs(w,{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"new_category",children:"Category"}),e.jsxs("select",{id:"new_category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:r.category,onChange:t=>u(i=>({...i,category:t.target.value})),children:[e.jsx("option",{value:"motorbike",children:"Motorbike"}),e.jsx("option",{value:"car",children:"Car"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(o,{htmlFor:"new_name",children:"Name"}),e.jsx(h,{id:"new_name",value:r.name,onChange:t=>u(i=>({...i,name:t.target.value})),placeholder:"e.g. Honda Airblade"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"new_inventory",children:"Inventory"}),e.jsx(h,{id:"new_inventory",type:"number",min:0,value:r.inventory_count,onChange:t=>u(i=>({...i,inventory_count:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"new_price",children:"Price/day (USD)"}),e.jsx(h,{id:"new_price",type:"number",min:0,value:r.price_per_day,onChange:t=>u(i=>({...i,price_per_day:t.target.value}))})]}),e.jsxs("div",{className:"md:col-span-5 flex gap-3",children:[e.jsx(g,{type:"button",onClick:A,disabled:p==="new",className:"bg-blue-600 hover:bg-blue-700",children:p==="new"?"Adding…":"Add vehicle"}),e.jsx(g,{type:"button",variant:"outline",onClick:x,disabled:C,children:"Refresh"}),e.jsx(g,{asChild:!0,variant:"ghost",children:e.jsx(B,{to:"/book",children:"View booking page"})})]})]})]}),e.jsxs(v,{className:"shadow-lg",children:[e.jsxs(_,{children:[e.jsx(f,{children:"Vehicles"}),e.jsx(N,{children:C?"Loading…":`${j.length} total`})]}),e.jsx(w,{className:"space-y-8",children:Object.entries(I).map(([t,i])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold capitalize",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(a=>e.jsx(v,{className:"border border-gray-200",children:e.jsxs(w,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",e.jsx("code",{className:"break-all",children:a.id})]})]}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:a.active?"text-green-700 font-semibold":"text-gray-600 font-semibold",children:a.active?"Active":"Inactive"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:`inv_${a.id}`,children:"Inventory"}),e.jsx(h,{id:`inv_${a.id}`,type:"number",min:0,defaultValue:a.inventory_count??0,onBlur:c=>{const s=Math.max(0,parseInt(c.target.value,10)||0);s!==(a.inventory_count??0)&&b(a.id,{inventory_count:s})}})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`price_${a.id}`,children:"Price/day"}),e.jsx(h,{id:`price_${a.id}`,type:"number",min:0,defaultValue:a.price_per_day??"",onBlur:c=>{const s=c.target.value,S=s===""?null:Number(s),E=a.price_per_day===null||a.price_per_day===void 0?null:Number(a.price_per_day),V=Number.isFinite(S)?S:null;V!==E&&b(a.id,{price_per_day:V})}})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(g,{type:"button",variant:"outline",disabled:p===a.id,onClick:()=>b(a.id,{active:!a.active}),children:p===a.id?"Saving…":a.active?"Deactivate":"Activate"})})]})},a.id))})]},t))})]})]})]})]})};export{H as default};
