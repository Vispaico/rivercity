import{c as w,f as Z,r as i,h as $,i as q,j as e,k as F,m as b,L as u,B as r,l as m,I as x,s as h}from"./index-9b949042.js";import{P as G}from"./PageHeader-62388ab2.js";import{C as l,a as n,b as c,e as o,c as d}from"./card-129a46a6.js";import{T as J,a as K,b as y,c as v}from"./tabs-5fd5721e.js";import{C as O}from"./calendar-days-305a59ae.js";import{S as Q}from"./settings-1b38e4d9.js";const H=w("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),X=w("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),I=w("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),Y=w("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),le=()=>{const{user:t,signOut:E,loading:D,isAdmin:R}=Z(),[f,N]=i.useState(!1),[V,k]=i.useState("bookings"),[g,C]=i.useState(!1),[p,P]=i.useState(!1),[S,L]=i.useState(""),[_,M]=i.useState(""),[U,A]=i.useState(""),[T,B]=i.useState(""),z=$(),{toast:a}=q();i.useEffect(()=>{L(t?.user_metadata?.full_name||""),M(t?.user_metadata?.phone||"")},[t]);const W=async()=>{N(!0);try{const{error:s}=await E();if(s)throw s;a({title:"Logged Out",description:"You have been successfully logged out.",className:"bg-blue-500 text-white"}),z("/")}catch(s){a({title:"Logout Failed",description:s.message||"Could not log you out.",variant:"destructive"})}finally{N(!1)}};return D?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(F,{className:"h-12 w-12 animate-spin text-blue-600"})}):e.jsxs("div",{children:[e.jsx(G,{title:`Welcome, ${t?.user_metadata?.full_name||t?.email||"Rider"}!`,subtitle:"Manage your bookings, view history, and update your profile.",breadcrumbs:[{name:"Home",link:"/"},{name:"Dashboard"}]}),e.jsx("section",{className:"pt-24 pb-16 lg:pb-24 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[R&&e.jsx(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:"mb-8",children:e.jsxs(l,{className:"shadow-lg bg-gradient-to-r from-blue-500 to-indigo-600 text-white",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Admin Tools"}),e.jsx(o,{className:"text-blue-100",children:"Access special management sections."})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(u,{to:"/dashboard/blog",children:e.jsxs(r,{className:"bg-white text-blue-600 hover:bg-blue-50 font-semibold",children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Manage Blog Posts"]})}),e.jsx(u,{to:"/dashboard/vehicles",children:e.jsxs(r,{className:"bg-white text-blue-600 hover:bg-blue-50 font-semibold",children:[e.jsx(O,{className:"mr-2 h-4 w-4"})," Manage Vehicle Inventory"]})}),e.jsx(u,{to:"/dashboard/marketplace",children:e.jsxs(r,{className:"bg-white text-blue-600 hover:bg-blue-50 font-semibold",children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," Marketplace Admin"]})})]})})]})}),e.jsx(b.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3},className:"mb-8",children:e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Earn with your vehicle"}),e.jsx(o,{children:"List your car or motorbike on Rivercity. We set the rental price, pay you 70% by bank transfer, 7 days after completion."})]}),e.jsx(d,{children:e.jsx(u,{to:"/dashboard/partner",children:e.jsx(r,{className:"bg-blue-600 hover:bg-blue-700",children:"Open Partner Portal"})})})]})}),e.jsxs(J,{value:V,onValueChange:k,className:"w-full",children:[e.jsx(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(K,{className:"grid w-full grid-cols-2 md:grid-cols-4 gap-2 h-auto p-2 mb-8 bg-white shadow-sm",children:[e.jsxs(y,{value:"bookings",className:"py-3 data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:shadow-md",children:[e.jsx(O,{className:"mr-2 h-5 w-5"})," My Bookings"]}),e.jsxs(y,{value:"history",className:"py-3 data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:shadow-md",children:[e.jsx(H,{className:"mr-2 h-5 w-5"})," Rental History"]}),e.jsxs(y,{value:"profile",className:"py-3 data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:shadow-md",children:[e.jsx(Y,{className:"mr-2 h-5 w-5"})," Profile"]}),e.jsxs(y,{value:"settings",className:"py-3 data-[state=active]:bg-blue-100 data-[state=active]:text-blue-700 data-[state=active]:shadow-md",children:[e.jsx(Q,{className:"mr-2 h-5 w-5"})," Settings"]})]})}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsx(v,{value:"bookings",children:e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Current & Upcoming Bookings"}),e.jsx(o,{children:"Manage your active and future rentals."})]}),e.jsx(d,{className:"space-y-4",children:e.jsxs("p",{className:"text-gray-600",children:["You have no upcoming bookings. ",e.jsx(u,{to:"/motorbikes",className:"text-blue-600 hover:underline",children:"Book a new ride?"})]})})]})}),e.jsx(v,{value:"history",children:e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Rental History"}),e.jsx(o,{children:"View your past rentals with us."})]}),e.jsx(d,{className:"space-y-4",children:e.jsx("p",{className:"text-gray-600",children:"Your rental history is empty."})})]})}),e.jsx(v,{value:"profile",children:e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Your Profile"}),e.jsx(o,{children:"Update your personal information and preferences."})]}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{className:"h-10 w-10 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:t?.user_metadata?.full_name||"N/A"}),e.jsx("p",{className:"text-sm text-gray-500",children:t?.email})]})]}),e.jsxs(r,{variant:"outline",onClick:()=>k("settings"),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Edit Profile"]})]})]})}),e.jsx(v,{value:"settings",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Account"}),e.jsx(o,{children:"Update your basic account details."})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Email"}),e.jsx(x,{value:t?.email||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(m,{children:"User ID"}),e.jsx(x,{value:t?.id||"",disabled:!0,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"account_full_name",children:"Full name"}),e.jsx(x,{id:"account_full_name",value:S,onChange:s=>L(s.target.value),placeholder:"Your name",disabled:g})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"account_phone",children:"Phone (optional)"}),e.jsx(x,{id:"account_phone",value:_,onChange:s=>M(s.target.value),placeholder:"+84...",disabled:g})]})]}),e.jsx(r,{type:"button",className:"bg-blue-600 hover:bg-blue-700",disabled:g||!h,onClick:async()=>{if(!h){a({title:"Settings unavailable",description:"Supabase is not configured.",variant:"destructive"});return}C(!0);try{const{error:s}=await h.auth.updateUser({data:{full_name:S.trim()||null,phone:_.trim()||null}});if(s)throw s;a({title:"Saved",description:"Your account details were updated.",className:"bg-green-500 text-white"})}catch(s){a({title:"Could not update account",description:s.message||"Please try again.",variant:"destructive"})}finally{C(!1)}},children:g?"Saving…":"Save changes"}),!h&&e.jsx("p",{className:"text-sm text-gray-600",children:"Account settings are unavailable because Supabase is not configured."})]})]}),e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Security"}),e.jsx(o,{children:"Change your password."})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"new_password",children:"New password"}),e.jsx(x,{id:"new_password",type:"password",value:U,onChange:s=>A(s.target.value),placeholder:"••••••••",disabled:p})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"confirm_password",children:"Confirm new password"}),e.jsx(x,{id:"confirm_password",type:"password",value:T,onChange:s=>B(s.target.value),placeholder:"••••••••",disabled:p})]})]}),e.jsx(r,{type:"button",variant:"outline",disabled:p||!h,onClick:async()=>{if(!h){a({title:"Password change unavailable",description:"Supabase is not configured.",variant:"destructive"});return}const s=U.trim();if(s.length<6){a({title:"Password too short",description:"Use at least 6 characters.",variant:"destructive"});return}if(s!==T.trim()){a({title:"Passwords do not match",description:"Please re-type your new password.",variant:"destructive"});return}P(!0);try{const{error:j}=await h.auth.updateUser({password:s});if(j)throw j;a({title:"Password updated",description:"Your password has been changed.",className:"bg-green-500 text-white"}),A(""),B("")}catch(j){a({title:"Could not update password",description:j.message||"Please try again.",variant:"destructive"})}finally{P(!1)}},children:p?"Updating…":"Update password"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["If you can’t access your account, use ",e.jsx(u,{to:"/login",className:"text-blue-600 hover:underline",children:"Forgot password"}),"."]})]})]}),e.jsxs(l,{className:"shadow-lg",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Sign out"}),e.jsx(o,{children:"Log out of your account on this device."})]}),e.jsx(d,{children:e.jsxs(r,{onClick:W,variant:"destructive",disabled:f,children:[f?e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(X,{className:"mr-2 h-4 w-4"}),"Log Out"]})})]})]})})]})]})]})})]})};export{le as default};
