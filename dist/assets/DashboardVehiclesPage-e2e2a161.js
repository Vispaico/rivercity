import{i as B,r as d,j as e,s as n,l,I as h,T as L,B as v,L as D}from"./index-f09a1a04.js";import{P as U}from"./PageHeader-7bb6aaac.js";import{C as j,a as N,b as C,e as k,c as S}from"./card-aa142bbf.js";import{v as $}from"./vehicleCatalog-41d3bb9c.js";const Y=()=>{const{toast:u}=B(),[V,b]=d.useState(!0),[x,p]=d.useState(null),[f,F]=d.useState([]),[A,y]=d.useState(""),I=d.useMemo(()=>[...$.motorbike||[],...$.car||[]].filter(a=>a?.category&&a?.slug).map(a=>({key:`${a.category}:${a.slug}`,category:a.category,name:a.name,price_per_day:a.price??"",description:a.description??"",image_url:a.image??""})),[]),[r,c]=d.useState({category:"motorbike",name:"",description:"",image_url:"",price_per_day:"",inventory_count:"0",active:!0}),P=d.useMemo(()=>f.reduce((i,a)=>{const t=a.category||"other";return i[t]=i[t]||[],i[t].push(a),i},{}),[f]),_=async()=>{if(!n){b(!1);return}b(!0);const{data:i,error:a}=await n.from("vehicles").select("id, category, name, description, image_url, price_per_day, inventory_count, active, sort_order").order("sort_order",{ascending:!0}).order("name",{ascending:!0});a?(u({title:"Failed to load vehicles",description:a.message,variant:"destructive"}),F([])):F(i||[]),b(!1)};d.useEffect(()=>{_()},[]);const w=async(i,a)=>{if(!n)return;p(i);const{error:t}=await n.from("vehicles").update(a).eq("id",i);t?u({title:"Save failed",description:t.message,variant:"destructive"}):(u({title:"Saved",description:"Vehicle updated.",className:"bg-blue-500 text-white"}),await _()),p(null)},T=async()=>{if(!n)return;const i=r.name.trim(),a=r.description.trim(),t=r.image_url.trim();if(!i){u({title:"Name required",description:"Enter a vehicle name.",variant:"destructive"});return}const s=Math.max(0,parseInt(r.inventory_count,10)||0),o=r.price_per_day===""?null:Number(r.price_per_day);p("new");const g={category:r.category,name:i,description:a||null,image_url:t||null,inventory_count:s,price_per_day:Number.isFinite(o)?o:null,active:!!r.active};let{error:m}=await n.from("vehicles").insert([{...g,listing_status:"approved"}]);if(m&&/column .*listing_status.* does not exist/i.test(m.message)&&({error:m}=await n.from("vehicles").insert([g])),m){u({title:"Create failed",description:m.message,variant:"destructive"}),p(null);return}u({title:"Created",description:"Vehicle added.",className:"bg-blue-500 text-white"}),y(""),c({category:"motorbike",name:"",description:"",image_url:"",price_per_day:"",inventory_count:"0",active:!0}),await _(),p(null)};return e.jsxs("div",{className:"bg-gray-50",children:[e.jsx(U,{title:"Vehicle Inventory",subtitle:"Set availability per vehicle model (inventory count).",breadcrumbs:[{name:"Home",link:"/"},{name:"Dashboard",link:"/dashboard"},{name:"Vehicles"}]}),e.jsxs("main",{className:"container mx-auto px-4 py-12 space-y-6",children:[!n&&e.jsx(j,{className:"shadow-lg",children:e.jsxs(N,{children:[e.jsx(C,{children:"Supabase not configured"}),e.jsx(k,{children:"Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY to enable inventory management."})]})}),n&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"shadow-lg",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Add a vehicle"}),e.jsx(k,{children:"This controls what shows on the booking page. You can also manage vehicles in Supabase Table Editor."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"new_category",children:"Category"}),e.jsxs("select",{id:"new_category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:r.category,onChange:i=>{c(a=>({...a,category:i.target.value})),y("")},children:[e.jsx("option",{value:"motorbike",children:"Motorbike"}),e.jsx("option",{value:"car",children:"Car"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"new_preset",children:"From site catalog (optional)"}),e.jsxs("select",{id:"new_preset",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:A,onChange:i=>{const a=i.target.value;y(a);const t=I.find(s=>s.key===a);t&&c(s=>({...s,category:t.category,name:t.name,description:t.description,image_url:t.image_url,price_per_day:String(t.price_per_day??""),inventory_count:s.inventory_count==="0"?"1":s.inventory_count,active:!0}))},children:[e.jsx("option",{value:"",children:"Select a model…"}),I.slice().sort((i,a)=>`${i.category} ${i.name}`.localeCompare(`${a.category} ${a.name}`)).map(i=>e.jsxs("option",{value:i.key,children:[i.category," — ",i.name]},i.key))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{htmlFor:"new_name",children:"Name"}),e.jsx(h,{id:"new_name",value:r.name,onChange:i=>{c(a=>({...a,name:i.target.value})),y("")},placeholder:"e.g. Yamaha Exciter 150"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"new_inventory",children:"Inventory"}),e.jsx(h,{id:"new_inventory",type:"number",min:0,value:r.inventory_count,onChange:i=>c(a=>({...a,inventory_count:i.target.value}))})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"new_price",children:"Price/day (USD)"}),e.jsx(h,{id:"new_price",type:"number",min:0,value:r.price_per_day,onChange:i=>c(a=>({...a,price_per_day:i.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"new_image_url",children:"Image URL (optional)"}),e.jsx(h,{id:"new_image_url",value:r.image_url,onChange:i=>c(a=>({...a,image_url:i.target.value})),placeholder:"https://... or /image.webp"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"new_description",children:"Short description (optional)"}),e.jsx(L,{id:"new_description",value:r.description,onChange:i=>c(a=>({...a,description:i.target.value})),rows:2,placeholder:"Shown on the booking page"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{type:"button",onClick:T,disabled:x==="new",className:"bg-blue-600 hover:bg-blue-700",children:x==="new"?"Adding…":"Add vehicle"}),e.jsx(v,{type:"button",variant:"outline",onClick:_,disabled:V,children:"Refresh"}),e.jsx(v,{asChild:!0,variant:"ghost",children:e.jsx(D,{to:"/book",children:"View booking page"})})]})]})]}),e.jsxs(j,{className:"shadow-lg",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Vehicles"}),e.jsx(k,{children:V?"Loading…":`${f.length} total`})]}),e.jsx(S,{className:"space-y-8",children:Object.entries(P).map(([i,a])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold capitalize",children:i}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.map(t=>e.jsx(j,{className:"border border-gray-200",children:e.jsxs(S,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",e.jsx("code",{className:"break-all",children:t.id})]})]}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:t.active?"text-green-700 font-semibold":"text-gray-600 font-semibold",children:t.active?"Active":"Inactive"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:`inv_${t.id}`,children:"Inventory"}),e.jsx(h,{id:`inv_${t.id}`,type:"number",min:0,defaultValue:t.inventory_count??0,onBlur:s=>{const o=Math.max(0,parseInt(s.target.value,10)||0);o!==(t.inventory_count??0)&&w(t.id,{inventory_count:o})}})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:`price_${t.id}`,children:"Price/day"}),e.jsx(h,{id:`price_${t.id}`,type:"number",min:0,defaultValue:t.price_per_day??"",onBlur:s=>{const o=s.target.value,g=o===""?null:Number(o),m=t.price_per_day===null||t.price_per_day===void 0?null:Number(t.price_per_day),E=Number.isFinite(g)?g:null;E!==m&&w(t.id,{price_per_day:E})}})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(v,{type:"button",variant:"outline",disabled:x===t.id,onClick:()=>w(t.id,{active:!t.active}),children:x===t.id?"Saving…":t.active?"Deactivate":"Activate"})})]})},t.id))})]},i))})]})]})]})]})};export{Y as default};
