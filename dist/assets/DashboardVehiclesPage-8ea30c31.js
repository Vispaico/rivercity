import{i as T,r as h,j as e,s as m,l as c,I as p,T as U,B as w,L}from"./index-ff5f5ba8.js";import{P as M}from"./PageHeader-27ee59ae.js";import{C as f,a as C,b as S,e as F,c as V}from"./card-86508010.js";import{v as E}from"./vehicleCatalog-7a74d63a.js";const Y=()=>{const{toast:_}=T(),[$,N]=h.useState(!0),[j,g]=h.useState(null),[k,I]=h.useState([]),[A,b]=h.useState(""),P=h.useMemo(()=>[...E.motorbike||[],...E.car||[]].filter(i=>i?.category&&i?.slug).map(i=>({key:`${i.category}:${i.slug}`,category:i.category,name:i.name,price_per_day:i.price??"",price_per_week:i.priceWeek??"",price_per_month:i.priceMonth??"",description:i.description??"",image_url:i.image??""})),[]),[n,d]=h.useState({category:"motorbike",name:"",description:"",image_url:"",price_per_day:"",price_per_week:"",price_per_month:"",inventory_count:"0",active:!0}),B=h.useMemo(()=>k.reduce((t,i)=>{const r=i.category||"other";return t[r]=t[r]||[],t[r].push(i),t},{}),[k]),v=async()=>{if(!m){N(!1);return}N(!0);const{data:t,error:i}=await m.from("vehicles").select("id, category, name, description, image_url, price_per_day, price_per_week, price_per_month, inventory_count, active, sort_order").order("sort_order",{ascending:!0}).order("name",{ascending:!0});i?(_({title:"Failed to load vehicles",description:i.message,variant:"destructive"}),I([])):I(t||[]),N(!1)};h.useEffect(()=>{v()},[]);const x=async(t,i)=>{if(!m)return;g(t);const{error:r}=await m.from("vehicles").update(i).eq("id",t);r?_({title:"Save failed",description:r.message,variant:"destructive"}):(_({title:"Saved",description:"Vehicle updated.",className:"bg-blue-500 text-white"}),await v()),g(null)},D=async()=>{if(!m)return;const t=n.name.trim(),i=n.description.trim(),r=n.image_url.trim();if(!t){_({title:"Name required",description:"Enter a vehicle name.",variant:"destructive"});return}const a=Math.max(0,parseInt(n.inventory_count,10)||0),s=n.price_per_day===""?null:Number(n.price_per_day),l=n.price_per_week===""?null:Number(n.price_per_week),u=n.price_per_month===""?null:Number(n.price_per_month);g("new");const o={category:n.category,name:t,description:i||null,image_url:r||null,inventory_count:a,price_per_day:Number.isFinite(s)?s:null,price_per_week:Number.isFinite(l)?l:null,price_per_month:Number.isFinite(u)?u:null,active:!!n.active};let{error:y}=await m.from("vehicles").insert([{...o,listing_status:"approved"}]);if(y&&/column .*listing_status.* does not exist/i.test(y.message)&&({error:y}=await m.from("vehicles").insert([o])),y){_({title:"Create failed",description:y.message,variant:"destructive"}),g(null);return}_({title:"Created",description:"Vehicle added.",className:"bg-blue-500 text-white"}),b(""),d({category:"motorbike",name:"",description:"",image_url:"",price_per_day:"",price_per_week:"",price_per_month:"",inventory_count:"0",active:!0}),await v(),g(null)};return e.jsxs("div",{className:"bg-gray-50",children:[e.jsx(M,{title:"Vehicle Inventory",subtitle:"Set availability per vehicle model (inventory count).",breadcrumbs:[{name:"Home",link:"/"},{name:"Dashboard",link:"/dashboard"},{name:"Vehicles"}]}),e.jsxs("main",{className:"container mx-auto px-4 py-12 space-y-6",children:[!m&&e.jsx(f,{className:"shadow-lg",children:e.jsxs(C,{children:[e.jsx(S,{children:"Supabase not configured"}),e.jsx(F,{children:"Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY to enable inventory management."})]})}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{className:"shadow-lg",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Add a vehicle"}),e.jsx(F,{children:"This controls what shows on the booking page. You can also manage vehicles in Supabase Table Editor."})]}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-9 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_category",children:"Category"}),e.jsxs("select",{id:"new_category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:n.category,onChange:t=>{d(i=>({...i,category:t.target.value})),b("")},children:[e.jsx("option",{value:"motorbike",children:"Motorbike"}),e.jsx("option",{value:"car",children:"Car"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(c,{htmlFor:"new_preset",children:"From site catalog (optional)"}),e.jsxs("select",{id:"new_preset",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:A,onChange:t=>{const i=t.target.value;b(i);const r=P.find(a=>a.key===i);r&&d(a=>({...a,category:r.category,name:r.name,description:r.description,image_url:r.image_url,price_per_day:String(r.price_per_day??""),price_per_week:String(r.price_per_week??""),price_per_month:String(r.price_per_month??""),inventory_count:a.inventory_count==="0"?"1":a.inventory_count,active:!0}))},children:[e.jsx("option",{value:"",children:"Select a model…"}),P.slice().sort((t,i)=>`${t.category} ${t.name}`.localeCompare(`${i.category} ${i.name}`)).map(t=>e.jsxs("option",{value:t.key,children:[t.category," — ",t.name]},t.key))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(c,{htmlFor:"new_name",children:"Name"}),e.jsx(p,{id:"new_name",value:n.name,onChange:t=>{d(i=>({...i,name:t.target.value})),b("")},placeholder:"e.g. Yamaha Exciter 150"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_inventory",children:"Inventory"}),e.jsx(p,{id:"new_inventory",type:"number",min:0,value:n.inventory_count,onChange:t=>d(i=>({...i,inventory_count:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_price",children:"Price/day (USD)"}),e.jsx(p,{id:"new_price",type:"number",min:0,value:n.price_per_day,onChange:t=>d(i=>({...i,price_per_day:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_price_week",children:"Price/week (USD)"}),e.jsx(p,{id:"new_price_week",type:"number",min:0,value:n.price_per_week,onChange:t=>d(i=>({...i,price_per_week:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_price_month",children:"Price/month (USD)"}),e.jsx(p,{id:"new_price_month",type:"number",min:0,value:n.price_per_month,onChange:t=>d(i=>({...i,price_per_month:t.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_image_url",children:"Image URL (optional)"}),e.jsx(p,{id:"new_image_url",value:n.image_url,onChange:t=>d(i=>({...i,image_url:t.target.value})),placeholder:"https://... or /image.webp"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"new_description",children:"Short description (optional)"}),e.jsx(U,{id:"new_description",value:n.description,onChange:t=>d(i=>({...i,description:t.target.value})),rows:2,placeholder:"Shown on the booking page"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{type:"button",onClick:D,disabled:j==="new",className:"bg-blue-600 hover:bg-blue-700",children:j==="new"?"Adding…":"Add vehicle"}),e.jsx(w,{type:"button",variant:"outline",onClick:v,disabled:$,children:"Refresh"}),e.jsx(w,{asChild:!0,variant:"ghost",children:e.jsx(L,{to:"/book",children:"View booking page"})})]})]})]}),e.jsxs(f,{className:"shadow-lg",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Vehicles"}),e.jsx(F,{children:$?"Loading…":`${k.length} total`})]}),e.jsx(V,{className:"space-y-8",children:Object.entries(B).map(([t,i])=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold capitalize",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(r=>e.jsx(f,{className:"border border-gray-200",children:e.jsxs(V,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",e.jsx("code",{className:"break-all",children:r.id})]})]}),e.jsx("div",{className:"text-sm",children:e.jsx("span",{className:r.active?"text-green-700 font-semibold":"text-gray-600 font-semibold",children:r.active?"Active":"Inactive"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:`inv_${r.id}`,children:"Inventory"}),e.jsx(p,{id:`inv_${r.id}`,type:"number",min:0,defaultValue:r.inventory_count??0,onBlur:a=>{const s=Math.max(0,parseInt(a.target.value,10)||0);s!==(r.inventory_count??0)&&x(r.id,{inventory_count:s})}})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`price_${r.id}`,children:"Price/day"}),e.jsx(p,{id:`price_${r.id}`,type:"number",min:0,defaultValue:r.price_per_day??"",onBlur:a=>{const s=a.target.value,l=s===""?null:Number(s),u=r.price_per_day===null||r.price_per_day===void 0?null:Number(r.price_per_day),o=Number.isFinite(l)?l:null;o!==u&&x(r.id,{price_per_day:o})}})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`price_week_${r.id}`,children:"Price/week"}),e.jsx(p,{id:`price_week_${r.id}`,type:"number",min:0,defaultValue:r.price_per_week??"",onBlur:a=>{const s=a.target.value,l=s===""?null:Number(s),u=r.price_per_week===null||r.price_per_week===void 0?null:Number(r.price_per_week),o=Number.isFinite(l)?l:null;o!==u&&x(r.id,{price_per_week:o})}})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`price_month_${r.id}`,children:"Price/month"}),e.jsx(p,{id:`price_month_${r.id}`,type:"number",min:0,defaultValue:r.price_per_month??"",onBlur:a=>{const s=a.target.value,l=s===""?null:Number(s),u=r.price_per_month===null||r.price_per_month===void 0?null:Number(r.price_per_month),o=Number.isFinite(l)?l:null;o!==u&&x(r.id,{price_per_month:o})}})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(w,{type:"button",variant:"outline",disabled:j===r.id,onClick:()=>x(r.id,{active:!r.active}),children:j===r.id?"Saving…":r.active?"Deactivate":"Activate"})})]})},r.id))})]},t))})]})]})]})]})};export{Y as default};
